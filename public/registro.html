<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BielsaSys — Registro B2B</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root{--bg:#0e0f0a;--card:#1c1e14;--border:#2a2d1e;--accent:#a8c45a;--red:#e05a5a;--text:#e8e6dc;--muted:#7a7d6a;--white:#f5f4ee}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;font-weight:300;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:2rem}
.bg-glow{position:fixed;inset:0;z-index:0;background:radial-gradient(ellipse 60% 50% at 50% 50%,rgba(168,196,90,.05),transparent 70%)}
.wrap{position:relative;z-index:1;width:100%;max-width:480px}
.logo{font-family:'Playfair Display',serif;font-size:1.4rem;font-weight:900;color:var(--white);text-align:center;margin-bottom:.3rem}
.logo span{color:var(--accent)}
.logo small{display:block;font-family:'DM Sans',sans-serif;font-size:.7rem;color:var(--muted);letter-spacing:.1em;text-transform:uppercase;margin-top:.2rem}
.card{background:var(--card);border:1px solid var(--border);border-radius:6px;padding:2rem;margin-top:1.8rem;animation:fadeUp .4s ease}
.card-title{font-family:'Playfair Display',serif;font-size:1.3rem;color:var(--white);margin-bottom:.3rem}
.card-sub{font-size:.82rem;color:var(--muted);margin-bottom:1.8rem}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:.8rem}
.fg{display:flex;flex-direction:column;gap:.4rem;margin-bottom:.9rem}
.fg.full{grid-column:1/-1}
.fg label{font-size:.68rem;letter-spacing:.1em;text-transform:uppercase;color:var(--muted)}
.fg input{background:var(--bg);border:1px solid var(--border);color:var(--text);padding:.65rem .9rem;border-radius:2px;font-family:'DM Sans',sans-serif;font-size:.88rem;outline:none;transition:border-color .2s;width:100%}
.fg input:focus{border-color:var(--accent)}
.fg input.err{border-color:var(--red)}
.sep{border:none;border-top:1px solid var(--border);margin:1.2rem 0}
.btn{width:100%;background:var(--accent);color:#0e0f0a;padding:.8rem;border-radius:2px;border:none;font-family:'DM Sans',sans-serif;font-size:.9rem;font-weight:500;cursor:pointer;transition:all .2s;margin-top:.5rem}
.btn:hover{background:#c0dd6a}
.btn:disabled{opacity:.5;cursor:not-allowed}
.error-msg{background:rgba(224,90,90,.1);border:1px solid rgba(224,90,90,.2);border-radius:2px;padding:.65rem .9rem;font-size:.8rem;color:var(--red);display:none;margin-bottom:1rem}
.error-msg.show{display:block}
.success-msg{background:rgba(168,196,90,.1);border:1px solid rgba(168,196,90,.2);border-radius:4px;padding:1.5rem;text-align:center;display:none}
.success-msg.show{display:block}
.success-msg h3{font-family:'Playfair Display',serif;color:var(--accent);margin-bottom:.5rem}
.success-msg p{font-size:.85rem;color:var(--muted)}
.bottom{text-align:center;margin-top:1.2rem;font-size:.8rem;color:var(--muted)}
.bottom a{color:var(--accent);text-decoration:none}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>
<div class="bg-glow"></div>
<div class="wrap">
  <div class="logo">Bielsa<span>Sys</span><small>Registro de Cuenta B2B</small></div>
  <div class="card">
    <div class="card-title">Crear cuenta</div>
    <div class="card-sub">Accede al portal de clientes para gestionar tus pedidos online.</div>

    <div class="error-msg" id="errMsg"></div>

    <div id="formWrap">
      <div class="form-row">
        <div class="fg"><label>Nombre completo *</label><input type="text" id="nombre" placeholder="María García"></div>
        <div class="fg"><label>Teléfono</label><input type="tel" id="tel" placeholder="612 345 678"></div>
      </div>
      <hr class="sep">
      <div class="form-row">
        <div class="fg"><label>Empresa / Negocio</label><input type="text" id="empresa" placeholder="Restaurante El Rincón"></div>
        <div class="fg"><label>CIF / NIF</label><input type="text" id="cif" placeholder="B12345678"></div>
      </div>
      <hr class="sep">
      <div class="fg"><label>Email *</label><input type="email" id="email" placeholder="pedidos@restaurante.com"></div>
      <div class="form-row">
        <div class="fg"><label>Contraseña *</label><input type="password" id="pass" placeholder="Mínimo 6 caracteres"></div>
        <div class="fg"><label>Confirmar contraseña *</label><input type="password" id="pass2" placeholder="Repite la contraseña"></div>
      </div>
      <button class="btn" id="regBtn">Crear cuenta →</button>
    </div>

    <div class="success-msg" id="successMsg">
      <h3>✅ Cuenta creada</h3>
      <p>Tu cuenta B2B ha sido registrada. Redirigiendo al portal...</p>
    </div>
  </div>
  <div class="bottom">¿Ya tienes cuenta? <a href="/portal">Inicia sesión →</a> · <a href="/">Volver a la tienda</a></div>
</div>
<script>
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('regBtn').addEventListener('click', doRegister);
  // Enter en cualquier input del formulario
  document.querySelectorAll('input').forEach(inp => {
    inp.addEventListener('keydown', e => { if (e.key === 'Enter') doRegister(); });
  });
});

async function doRegister() {
  const nombre = document.getElementById('nombre').value.trim();
  const email  = document.getElementById('email').value.trim();
  const pass   = document.getElementById('pass').value;
  const pass2  = document.getElementById('pass2').value;

  document.getElementById('errMsg').classList.remove('show');
  document.getElementById('pass2').classList.remove('err');

  if (!nombre || !email || !pass) { showErr('Nombre, email y contraseña son obligatorios.'); return; }
  if (pass.length < 6)            { showErr('La contraseña debe tener al menos 6 caracteres.'); return; }
  if (pass !== pass2)             { showErr('Las contraseñas no coinciden.'); document.getElementById('pass2').classList.add('err'); return; }

  const btn = document.getElementById('regBtn');
  btn.disabled    = true;
  btn.textContent = 'Registrando...';

  try {
    const r = await fetch('/api/cliente/registro', {
      method:  'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        nombre,
        email,
        password:  pass,
        empresa:   document.getElementById('empresa').value.trim(),
        cif:       document.getElementById('cif').value.trim(),
        telefono:  document.getElementById('tel').value.trim()
      })
    });
    const d = await r.json();
    if (!r.ok) throw new Error(d.error || 'Error al registrarse');

    // Guardar token y redirigir al portal
    sessionStorage.setItem('bielsa_client_token', d.token);
    document.getElementById('formWrap').style.display = 'none';
    document.getElementById('successMsg').classList.add('show');
    setTimeout(() => window.location.href = '/portal', 2000);

  } catch (e) {
    showErr(e.message);
    btn.disabled    = false;
    btn.textContent = 'Crear cuenta →';
  }
}

function showErr(msg) {
  const el = document.getElementById('errMsg');
  el.textContent = msg;
  el.classList.add('show');
}
</script>
</body>
</html>
